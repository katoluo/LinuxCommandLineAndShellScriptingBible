## 第三章 基本的 bash shell 命令

### 3.1 启动 shell

​	GNU bash shell 能提供对Linux系统的交互式访问。它是作为普通程序运行的，通常是在用户登录终端时启动。登录时系统启动的shell依赖于用户账户的配置。

​	/etc/passwd文件包含了所有系统用户账户列表以及每个用户的基本配置信息。以下是从/etc/passwd文件中取出的样例条目：

> kato​ : x : 1000 : 1000 : kato : /home/kato : /bin/zsh

​	每个条目有七个字段，字段之间用冒号分隔。系统使用字段中的数据来赋予用户账户某些特定特性。将在第七章更加详细的介绍。

### 3.2 shell 提示符

​	默认bash shell提示符是美元符号（$），这个符号表明shell在等待用户输入。

### 3.3 bash 手册

​	大多数Linux发行版自带用以查找shell命令及其他GNU工具信息的在线手册。

​	man命令用来访问存储在Linux系统上的手册页面。在想要查找的工具的名称面前输入man命令，就可以找到那个工具相应的手册条目。

​	手册页将与命令相关的信息分成了不同的节。每一节惯用的命名标准如下所示。

|      节       |            描述            |
| :-----------: | :------------------------: |
|     Name      | 显示命令名和一段简短的描述 |
|   Synopsis    |         命令的语法         |
| Configuration |        命令配置信息        |
|  Description  |      命令的一般性描述      |
|    Options    |        命令选项描述        |
|  Exit Status  |     命令的退出状态指示     |
| Return Value  |        命令的返回值        |
|    Errors     |       命令的错误消息       |
|  Environment  |    描述所使用的环境变量    |
|     Files     |       命令用到的文件       |
|   Versions    |       命令的版本信息       |
| Conforming to |      命令所遵从的标准      |
|     Notes     |      其他有帮助的资料      |
|     Bugs      |     提供提交bug的途径      |
|    Example    |       展示命令的用法       |
|    Authors    |     命令开发人员的信息     |
|   Copyright   |    命令源代码的版权状况    |
|   See Also    |   与该命令类型的其他命令   |

​	手册页还有对应的内容区域。每个内容区域否分配了一个数字，从1开始，一直到9，如下所示。

| 区域号 |       所涵盖的内容       |
| :----: | :----------------------: |
|   1    |  可执行程序或shell命令   |
|   2    |         系统调用         |
|   3    |          库调用          |
|   4    |         特殊文件         |
|   5    |      文件格式与约定      |
|   6    |           游戏           |
|   7    |     概览、约定及杂项     |
|   8    | 超级用户和系统管理员命令 |
|   9    |         内核例程         |

​	man工具通常提供的是命令所对应的最低编号的内容。当我们输入命令后，在内容的左上角和右上角，有一个数字（1）。这表示所显示的手册页来自内容区域1。

​	一个命令偶尔会在多个内容区域都有对应的手册页。要想查看所需要的页面，可以输入`man section# topic`。例如：`man 1 hostname`、`man 7 hostname`

​	手册页不是唯一的参考资料。还有另一种叫作info页面的信息。可以输入`info info`来了解info页面的相关内容。

另外，大多数命令都可以接受-help或--help选项来提供帮助。

### 3.4 浏览文件系统

#### 3.4.1 Linux 文件系统

​	Linux将文件存储在单个目录结构中，这个目录被称为**虚拟目录（virtual directory）**。虚拟目录将安装在PC上的所有存储设备的文件路径纳入单个目录结构中。

​	Linux虚拟目录结构只包含一个称为**根（root）**目录的基础目录。

​	在Linux中，你会看到下面这种路径：

> /home/kato/Documents/test.doc 
>
> 这表明文件test.doc位于Documents目录，Documents又位于rich目录中，rich则在home目录中。要注意的是，路径本身并没有提供任何有关文件究竟存放在哪个物理磁盘上的信息。

​	Linux虚拟目录中比较复杂的部分是它如何协调管理各个存储设备。在Linux PC上安装的第一块硬盘称为**根驱动器**。根驱动器包含了虚拟目录的核心，其他目录都是从那里开始构建的。

​	Linux会在根驱动器上创建一些特别的目录，我们称之为**挂载点（mount point）**。挂载点是虚拟目录中用于分配额外存储设备的目录。虚拟目录会让文件和目录出现在这些挂载点目录中，然而实际上它们却存储在另外一个驱动器中。

​	通常系统文件会存储在根驱动器中，而用户文件则存储在另一驱动器中，如图3-2所示。

![图3-2.png]()

​	图3-2展示了计算机中的两块硬盘。一块硬盘和虚拟目录的根目录（由正斜号/表示）关联起来。剩下的硬盘就可以挂载到虚拟目录结构中的任何地方。在这个例子中，第二块硬盘被挂载到了/home位置，用户目录都位于这个位置。

​	Linux文件系统结构是从Unix文件结构演进过来的。在Linux文件系统中，通用的目录名用于表示一些常见的功能。下表列出了一些较常见的Linux顶层虚拟目录名及其内容。

|  目录  |                           用途                            |
| :----: | :-------------------------------------------------------: |
|   /    |         虚拟目录的根目录。通常不会在这里存储文件          |
|  /bin  |            二进制目录，存放许多用户级的GNU工具            |
| /boot  |                  启动目录，存放启动文件                   |
|  /dev  |             设备目录，Linux在这里创建设备结点             |
|  /etc  |                     系统配置文件目录                      |
| /home  |              主目录，Linux在这里创建用户目录              |
|  /lib  |            库目录，存放系统和应用程序的库文件             |
| /media |           媒体目录，可移动媒体设备的常用挂载点            |
|  /mnt  |        挂载目录，另一个可移动媒体设备的常用挂载点         |
|  /opt  |        可选目录，常用于存放第三方软件包和数据文件         |
| /proc  |        进程目录，存放现有硬件及当前进程的相关信息         |
| /root  |                     root用户的主目录                      |
| /sbin  |          系统二进制目录，存放许多GNU管理员级工具          |
|  /run  |           运行目录，存放系统运作时的运行时数据            |
|  /srv  |             服务目录，存放本地服务的相关文件              |
|  /tmp  |      临时目录，可以在该目录中创建和删除临时工作文件       |
|  /usr  | 用户二进制目录，大量用户级的GNU工具和数据文件都存储在这里 |
|  /var  |      可变目录，用以存放经常变化的文件，比如日志文件       |

​	常见的目录名均基于文件系统层级标准（filesystem hierarchy standard, FHS）。

#### 3.4.2 遍历目录

​	有两个特殊字符可用于相对文件路径中：

​	单点符（.），表示当前目录；

​	双点符（..），表示当前目录的父目录。

### 3.5 文件和目录列表

#### 3.5.1 基本列表功能

​	ls命令最基本的形式会显示当前目录下的文件和目录，具体的参数用法使用`man ls`进行查看。

#### 3.5.2 显示长列表

​	在基本的输出列表中，ls命令并未输出太多每个文件的相关信息。要显示附加信息，另一个常用的参数是-l。-l参数会产生长列表格式的输出，包含了目录中每个文件的更多相关信息。例如：

> total 	48
>
> drwxr-xr-x	4	kato	kato	4096	12月	24	13 : 29	Book

​	这种长列表格式的输出在每一行中列出了单个文件或目录。除了文件名，输出中还有其他有用信息。输出的第一行显示了在目录中包含的总块数。在此之后，每一行都包含了关于文件（目录）的下述信息：

> 文件类型，比如目录（d）、文件（-）、字符型文件（c）或块设备（b）；
>
> 文件的权限（参见第六章）；
>
> 文件的硬链接总数；
>
> 文件属主的用户名；
>
> 文件属组的组名；
>
> 文件的大小（以字节为单位）；
>
> 文件的上次修改时间；
>
> 文件名或目录名。

#### 3.5.3 过滤输出列表

​	ls命令支持在命令行中定义过滤器。它会用过滤器来决定应该在输出中显示哪些文件过目录。

​	这个过滤器就是一个进行简单文本匹配的字符串。可以在要用的命令行参数之后添加这个过滤器：`ls -l my_script`

​	当用户指定特定文件的名称作为过滤器时，ls命令指回显示该文件的信息。ls命令能够识别标准通配符，并在过滤器中用它们进行模式匹配：

> 问好（?）代表一个字符：`ls -l my_scr?pt`
>
> 星号（*）代表零个或多个字符：`ls -l my*`、`ls -l my_s*t`

​	在过滤器中使用星号和问好被称为文件扩展匹配（file globbing），指的是使用通配符进行模式匹配的过程。通配符正式的名称叫作元字符通配符（metacharacter wildcards）。除了星号和问好之外，还有更多的元字符通配符可用于文件扩展匹配。可以使用中括号。

> `ls -l my_scr[ai]pt`，使用了中括号以及在特定位置上可能出现的两种字符：a或i。
>
> `ls -l f[a-i]ll`，字符范围[a-i]。
>
> `ls -l f[!a]ll`，使用感叹号（!）将不需要的内容排除在外

### 3.6 处理文件

#### 3.6.1 创建文件

​	可用touch命令轻松创建空文件，使用`man touch`进行进一步了解。

#### 3.6.2 复制文件

​	可用cp命令来完成复制文件，`cp source destination`，使用`man cp`进一步了解。

#### 3.6.3 制表键自动补全

​	tab键一键补全。

#### 3.6.4 链接文件

​	链接文件是Linux文件系统的一个优势。如需要在系统上维护同一文件的两份或多份副本，除了保存多份单独的物理文件副本之外，还可以采用保存一份物理文件副本和多个虚拟副本的方法。这种虚拟的副本就称为链接。链接是目录中指向文件真实位置的占位符。在Linux中有两种不同类型的文件链接：**符号链接**和**硬链接**。

​	符号连接就是一个实实在在的文件，它指向存放在虚拟目录结构中某个地方的另一个文件。这两个通过符号链接在一起的文件，彼此的内容并不相同。

​	要为一个文件创建**符号链接**，原始文件必须事先存在。然后可以使用ln命令以及-s选项来创建符号链接。

```shell
ls -l data_file
# -rw-rw-r-- 1 christine christine 1092 May 21 17:27 data_file
ln -s data_file sl_data_file
ls -l *data_file
# -rw-rw-r-- 1 christine christine 1092 May 21 17:27 data_file
# lrwxrwxrwx 1 christine christine 9 May 21 17:29 sl_data_file -> data_file
```

​	在上面的例子中，注意符号链接的名字sl_data_file位于ln命令中的第二个参数位置上。显示在长列表中符号文件名后的$\rightarrow$符号表明该文件是链接到文件data_file上的一个符号链接。

​	另外还要注意的是，符号链接的文件大小与数据文件的文件大小。符号链接sl_data_file只有各位数字节，而data_file有好几位数的字节大小。这是因为sl_data_file仅仅只是指向data_file而已。它们的内容并不相同，是两个完全不同的文件，当我们查看时，内容却显示是一样的。

​	**硬链接**会创建独立的虚拟文件，其中包含了原始文件的信息及位置。但是它们从根本上而言是统一个文件。引用硬链接文件等同于引用了源文件。要创建硬链接，原始文件也必须事先存在，只不过这次使用ln命令时不再需要加入额外的参数了。

```shell
ls -l code_file
# -rw-rw-r-- 1 christine christine 189 May 21 17:56 code_file
ln code_file hl_code_file
ls -li *code_file
# 296892 -rw-rw-r-- 2 christine christine 189 May 21 17:56 code_file
# 296892 -rw-rw-r-- 2 christine christine 189 May 21 17:56 hl_code_file
```

​	在上面的例子中，我们使用`ls -li`命令显示了*code_file的inode编号以及长列表。注意，带有硬链接的文件共享inode编号。这是因为它们终归是同一个文件。还要注意的是，链接计数显示这两个文件都有两个链接。另外，文件大小也一样。

***

**说明** 	只能对处于同一存储媒体的文件创建硬链接。要想在不同存储媒体的文件之间创建链接，只能使用符号链接。

***

​	复制链接文件的时候一定要小心。如果使用cp命令复制一个文件，而该文件又已经被链接到另一个源文件上，那么你得到的其实是源文件的一个副本。这很容易让人犯晕。用不着赋值链接文件，可以创建原始文件的另一个链接。同一个文件拥有多个链接，这完全没有问题。但是，千万别创建软链接文件的软链接。这会形成混乱的链接链，不仅容易断裂，还会造成各种麻烦。

#### 3.6.5 重命名文件

​	在Linux中，重命名文件称为移动（moving）。mv命令可以将文件和目录移动到另一个位置和重新命令。具体了解使用`man mv`查看。

#### 3.6.6 删除文件

​	在Linux中，删除（deleting）叫作移除（removing）。bash shell 中删除文件的命令是rm。具体用法使用`man rm`进一步了解。

### 3.7 处理目录

#### 3.7.1 创建目录

​	在Linux中创建目录使用mkdir命令即可，具体用法使用`man mkdir`进一步了解。

#### 3.7.2 删除目录

​	删除目录的基本命令是rmdir，具体用法使用`man rmdir`进行了解。

### 3.8 查看文件内容

#### 3.8.1 查看文件类型

​	在显示文件内容之前，应该先了解一下文件的类型。如果打开了一个二进制文件，你会在屏幕上看到各种乱码，甚至会把你的终端仿真器挂起。

​	file命令是一个随手可得的便捷工具。它能够探测文件的内部，并决定文件是什么类型的：

```shell
file my_file
# my_file: ASCII text
file New_dir
# New_Dir: directory
file sl_data_file
# sl_data_file: symbolic link to 'data_file'
file my_script
# my_script: Bourne-Again shell script, ASCII text executable
file /bin/ls
# /bin/ls: ELF 64-bit LSB executable, x86-64, version 1 (SYSV), dynamically linked (uses shared libs), for GNU/Linux 2.6.24, [...]
```

​	上面例子中的my_file是一个text（文本）文件。file命令不仅能确定文件中包含的文本信息，还能确定该文本文件的字符编码，ASCII；New_Dir文件是一个目录，以后可以使用file命令作为另一种区分目录的方法；sl_data_file是一个类型为符号链接的文件，file命令甚至能够告诉你它链接到了哪个文件上；my_script是脚本文件；最后一个例子是二进制可执行程序，file命令能够确定该程序编译时所面向的平台以及需要何种类型的库。如果你有未知源处获得的二进制文件，这会是个非常有用的特性。

#### 3.8.2 查看整个文件

​	在Linux上有3个不同的命令可以完成这个任务。

**1. cat 命令**

​	cat命令是显示文本文件中所有数据的得力工具。具体用法使用`man cat`进行了解。

**2. more命令**

​	cat命令的主要缺陷是：一旦运行，你就无法控制后面的操作。为了解决这个问题，开发人员编写了more命令。more命令会显示文本文件的内容，但会在显示每页数据之后停下。使用`man more`进一步了解。

**3. less命令**

​	具体使用查看man手册。

#### 3.8.3 查看部分文件

**1. tail命令**

​	tail命令会显示文件最后几行的内容（文件的“尾部”）。默认情况下，会显示文件的末尾10行。

**2. head命令**

​	head命令会显示文件开头那些行的内容。默认情况下，会显示文件的前10行。