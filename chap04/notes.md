## 第四章 更多的bash shell命令

### 4.1 监测程序

#### 4.1.1 探测进程

​	当程序运行在系统上时，我们称之为进程（process）。想要监测这些京城，需要熟悉ps命令的用法，它能输出运行在系统上的所有程序的许多信息。

​	默认情况下，ps命令并不会提供那么多的信息：

```shell
ps
#     PID TTY          TIME CMD
#  37494 pts/1    00:00:25 zsh
# 117527 pts/1    00:00:00 ps
```

​	默认情况下，ps命令指回显示运行在当前控制台下的属于当前用户的进程。在此例中，我们只运行了z shell（注意，shell也知识运行在系统上的另一个程序而已）以及ps命令本身。

​	上例中的基本输出显示了程序的进程ID（Process ID，PID）、它们运行在哪个终端（TTY）以及进程已用的CPU时间。

​	Linux系统中使用的GNU ps命令支持3中不同类型的命令行参数：

​	（1）Uninx风格的参数，前面加单破折线；

​	（2）BSD风格的参数，前面不加破折线；

​	（3）GNU风格的长参数，前面加双破折线。

​	具体使用发生查看man手册。

**1. Unix风格的参数**

​	-e参数指定显示所有运行在系统上的进程；-f参数则扩展了输出。

```shell
ps -ef
# UID          PID    PPID  C STIME TTY          TIME CMD
#kato       37494   37486  0 13:05 pts/1    00:00:25 /bin/zsh
#kato      122218   37494  0 21:57 pts/1    00:00:00 ps -f
```

​	UID：启动这些进程的用户；PID：进程的进程ID；PPID：父进程的进程号；C：进程生命周期中的CPU利用率；STIME：进程启动时的系统时间；TTY：进程启动时的终端设备；TIME：运行进程需要的累计CPU时间；CMD：启动的程序名称。

​	如果想要更多的信息，可采用-l参数，它会产生一个长格式输出。

```shell
ps -l
#F S   UID     PID    PPID  C PRI  NI ADDR SZ WCHAN  TTY          TIME CMD
#0 S  1000   37494   37486  0  80   0 -  5680 -      pts/1    00:00:25 zsh
#4 R  1000  123500   37494  0  80   0 -  3184 -      pts/1    00:00:00 ps
```

​	F：内核分配给进程的系统标记；S：进程的状态（O：正在运行；S：在休眠；R：可运行，正等待运行；Z：僵化，进程已结束但父进程已不存在；T：停止）；PRI：进程的优先级（数越大优先级越低）；NI：谦让度值用来参与决定优先级；ADDR：进程的内存地址；SZ：假如进程被换出，所需交换空间的大致大小；WCHAN：进程休眠的内核函数的地址。

**2. BSD风格的参数**

​	略。

**3. GNU长参数**

​	略。

### 4.1.2 实时监测进程

​	ps命令虽然在收集运行在系统上的进程信息时非常有用，但它只能显示某个时间点的信息。top命令跟ps命令相似，能够显示进程信息，但它是实时显示的。

​	top命令运行时，输出的第一部分显示的是系统的概况：第一行显示了当前时间、系统的运行时间、登录的用户数以及系统的平均负载。

​	平均负载有3个值：最近1分钟的、最近5分钟的和最近15分钟的平均负载。值越大说明系统的负载越高。由于进程短期的突发性活动，出现最近一分钟的高负载值也很常见，但如果近15分钟内的平均负载都很高，就说明系统可能有问题。

​	第二行显示了进程概要信息——top命令的输出中将进程叫作任务（task）：有多少进程处在运行、休眠、停止或是僵化状态。

​	下一行显示了CPU的概要信息。top根据进程的属主（用户还是系统）和进程的状态（运行、空闲还是等待）将CPU利用率分成几类输出。

​	紧跟其后的两行说明了系统内存的状态。第一行说的是系统的物理内存：总共有多少内存，当前永乐多少，还有多少空闲。后一行说的是同样的信息，不过是针对系统交换空间（如果分配了的话）的状态而言的。

![top命令运行时的输出.png]()	